<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.topline.mappers.PurchaseDetailMapper" >
  <resultMap id="BaseResultMap" type="com.topline.model.PurchaseDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    <id column="purd_id" property="purdId" jdbcType="INTEGER" />
    <result column="purd_pur_id" property="purdPurId" jdbcType="INTEGER" />
    <result column="purd_pdt_code" property="purdPdtCode" jdbcType="INTEGER" />
    <result column="purd_qty" property="purdQty" jdbcType="DOUBLE" />
    <result column="purd_price" property="purdPrice" jdbcType="DECIMAL" />
    <result column="purd_tamount" property="purdTamount" jdbcType="DECIMAL" />
    <result column="purd_discount" property="purdDiscount" jdbcType="DOUBLE" />
    <result column="purd_bonus" property="purdBonus" jdbcType="DOUBLE" />
    <result column="purd_status" property="purdStatus" jdbcType="VARCHAR" />
    <result column="purd_previous_qty" property="purdPreviousQty" jdbcType="DOUBLE" />
    <result column="purd_remarks" property="purdRemarks" jdbcType="VARCHAR" />
    <result column="purd_mtrade_price" property="purdMtradePrice" jdbcType="DECIMAL" />
    <result column="purd_expiry_dt" property="purdExpiryDt" jdbcType="DATE" />
    <result column="purd_serialNo" property="purdSerialNo" jdbcType="VARCHAR"  />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    purd_id, purd_pur_id, purd_pdt_code, purd_qty, purd_price, purd_tamount, purd_discount, 
    purd_bonus, purd_status, purd_previous_qty, purd_remarks, purd_mtrade_price, purd_expiry_dt,purd_serialNo
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.topline.model.PurchaseDetailExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from inv_purchases_details
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from inv_purchases_details
    where purd_id = #{purdId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    delete from inv_purchases_details
    where purd_id = #{purdId,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.topline.model.PurchaseDetailExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    delete from inv_purchases_details
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.topline.model.PurchaseDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    insert into inv_purchases_details (purd_id, purd_pur_id, purd_pdt_code, 
      purd_qty, purd_price, purd_tamount, 
      purd_discount, purd_bonus, purd_status, 
      purd_previous_qty, purd_remarks, purd_mtrade_price, 
      purd_expiry_dt,purd_serialNo)
    values (#{purdId,jdbcType=INTEGER}, #{purdPurId,jdbcType=INTEGER}, #{purdPdtCode,jdbcType=INTEGER}, 
      #{purdQty,jdbcType=DOUBLE}, #{purdPrice,jdbcType=DECIMAL}, #{purdTamount,jdbcType=DECIMAL}, 
      #{purdDiscount,jdbcType=DOUBLE}, #{purdBonus,jdbcType=DOUBLE}, #{purdStatus,jdbcType=VARCHAR}, 
      #{purdPreviousQty,jdbcType=DOUBLE}, #{purdRemarks,jdbcType=VARCHAR}, #{purdMtradePrice,jdbcType=DECIMAL}, 
      #{purdExpiryDt,jdbcType=DATE},#{purdSerialNo,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.topline.model.PurchaseDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    insert into inv_purchases_details
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="purdId != null" >
        purd_id,
      </if>
      <if test="purdPurId != null" >
        purd_pur_id,
      </if>
      <if test="purdPdtCode != null" >
        purd_pdt_code,
      </if>
      <if test="purdQty != null" >
        purd_qty,
      </if>
      <if test="purdPrice != null" >
        purd_price,
      </if>
      <if test="purdTamount != null" >
        purd_tamount,
      </if>
      <if test="purdDiscount != null" >
        purd_discount,
      </if>
      <if test="purdBonus != null" >
        purd_bonus,
      </if>
      <if test="purdStatus != null" >
        purd_status,
      </if>
      <if test="purdPreviousQty != null" >
        purd_previous_qty,
      </if>
      <if test="purdRemarks != null" >
        purd_remarks,
      </if>
      <if test="purdMtradePrice != null" >
        purd_mtrade_price,
      </if>
      <if test="purdExpiryDt != null" >
        purd_expiry_dt,
      </if>
      <if test="purdSerialNo != null" >
        purd_serialNo,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="purdId != null" >
        #{purdId,jdbcType=INTEGER},
      </if>
      <if test="purdPurId != null" >
        #{purdPurId,jdbcType=INTEGER},
      </if>
      <if test="purdPdtCode != null" >
        #{purdPdtCode,jdbcType=INTEGER},
      </if>
      <if test="purdQty != null" >
        #{purdQty,jdbcType=DOUBLE},
      </if>
      <if test="purdPrice != null" >
        #{purdPrice,jdbcType=DECIMAL},
      </if>
      <if test="purdTamount != null" >
        #{purdTamount,jdbcType=DECIMAL},
      </if>
      <if test="purdDiscount != null" >
        #{purdDiscount,jdbcType=DOUBLE},
      </if>
      <if test="purdBonus != null" >
        #{purdBonus,jdbcType=DOUBLE},
      </if>
      <if test="purdStatus != null" >
        #{purdStatus,jdbcType=VARCHAR},
      </if>
      <if test="purdPreviousQty != null" >
        #{purdPreviousQty,jdbcType=DOUBLE},
      </if>
      <if test="purdRemarks != null" >
        #{purdRemarks,jdbcType=VARCHAR},
      </if>
      <if test="purdMtradePrice != null" >
        #{purdMtradePrice,jdbcType=DECIMAL},
      </if>
      <if test="purdExpiryDt != null" >
        #{purdExpiryDt,jdbcType=DATE},
      </if>
      <if test="purdSerialNo != null" >
        #{purdSerialNo,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.topline.model.PurchaseDetailExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    select count(*) from inv_purchases_details
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    update inv_purchases_details
    <set >
      <if test="record.purdId != null" >
        purd_id = #{record.purdId,jdbcType=INTEGER},
      </if>
      <if test="record.purdPurId != null" >
        purd_pur_id = #{record.purdPurId,jdbcType=INTEGER},
      </if>
      <if test="record.purdPdtCode != null" >
        purd_pdt_code = #{record.purdPdtCode,jdbcType=INTEGER},
      </if>
      <if test="record.purdQty != null" >
        purd_qty = #{record.purdQty,jdbcType=DOUBLE},
      </if>
      <if test="record.purdPrice != null" >
        purd_price = #{record.purdPrice,jdbcType=DECIMAL},
      </if>
      <if test="record.purdTamount != null" >
        purd_tamount = #{record.purdTamount,jdbcType=DECIMAL},
      </if>
      <if test="record.purdDiscount != null" >
        purd_discount = #{record.purdDiscount,jdbcType=DOUBLE},
      </if>
      <if test="record.purdBonus != null" >
        purd_bonus = #{record.purdBonus,jdbcType=DOUBLE},
      </if>
      <if test="record.purdStatus != null" >
        purd_status = #{record.purdStatus,jdbcType=VARCHAR},
      </if>
      <if test="record.purdPreviousQty != null" >
        purd_previous_qty = #{record.purdPreviousQty,jdbcType=DOUBLE},
      </if>
      <if test="record.purdRemarks != null" >
        purd_remarks = #{record.purdRemarks,jdbcType=VARCHAR},
      </if>
      <if test="record.purdMtradePrice != null" >
        purd_mtrade_price = #{record.purdMtradePrice,jdbcType=DECIMAL},
      </if>
      <if test="record.purdExpiryDt != null" >
        purd_expiry_dt = #{record.purdExpiryDt,jdbcType=DATE},
      </if>
      <if test="record.purdSerialNo != null" >
        purd_serialNo = #{record.purdSerialNo,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    update inv_purchases_details
    set purd_id = #{record.purdId,jdbcType=INTEGER},
      purd_pur_id = #{record.purdPurId,jdbcType=INTEGER},
      purd_pdt_code = #{record.purdPdtCode,jdbcType=INTEGER},
      purd_qty = #{record.purdQty,jdbcType=DOUBLE},
      purd_price = #{record.purdPrice,jdbcType=DECIMAL},
      purd_tamount = #{record.purdTamount,jdbcType=DECIMAL},
      purd_discount = #{record.purdDiscount,jdbcType=DOUBLE},
      purd_bonus = #{record.purdBonus,jdbcType=DOUBLE},
      purd_status = #{record.purdStatus,jdbcType=VARCHAR},
      purd_previous_qty = #{record.purdPreviousQty,jdbcType=DOUBLE},
      purd_remarks = #{record.purdRemarks,jdbcType=VARCHAR},
      purd_mtrade_price = #{record.purdMtradePrice,jdbcType=DECIMAL},
      purd_expiry_dt = #{record.purdExpiryDt,jdbcType=DATE},
      purd_serialNo = #{purdSerialNo,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.topline.model.PurchaseDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    update inv_purchases_details
    <set >
      <if test="purdPurId != null" >
        purd_pur_id = #{purdPurId,jdbcType=INTEGER},
      </if>
      <if test="purdPdtCode != null" >
        purd_pdt_code = #{purdPdtCode,jdbcType=INTEGER},
      </if>
      <if test="purdQty != null" >
        purd_qty = #{purdQty,jdbcType=DOUBLE},
      </if>
      <if test="purdPrice != null" >
        purd_price = #{purdPrice,jdbcType=DECIMAL},
      </if>
      <if test="purdTamount != null" >
        purd_tamount = #{purdTamount,jdbcType=DECIMAL},
      </if>
      <if test="purdDiscount != null" >
        purd_discount = #{purdDiscount,jdbcType=DOUBLE},
      </if>
      <if test="purdBonus != null" >
        purd_bonus = #{purdBonus,jdbcType=DOUBLE},
      </if>
      <if test="purdStatus != null" >
        purd_status = #{purdStatus,jdbcType=VARCHAR},
      </if>
      <if test="purdPreviousQty != null" >
        purd_previous_qty = #{purdPreviousQty,jdbcType=DOUBLE},
      </if>
      <if test="purdRemarks != null" >
        purd_remarks = #{purdRemarks,jdbcType=VARCHAR},
      </if>
      <if test="purdMtradePrice != null" >
        purd_mtrade_price = #{purdMtradePrice,jdbcType=DECIMAL},
      </if>
      <if test="purdExpiryDt != null" >
        purd_expiry_dt = #{purdExpiryDt,jdbcType=DATE},
      </if>
      <if test="purdSerialNo != null" >
        purd_serialNo = #{purdSerialNo,jdbcType=VARCHAR},
      </if>
    </set>
    where purd_id = #{purdId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.topline.model.PurchaseDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 15:43:34 EAT 2015.
    -->
    update inv_purchases_details
    set purd_pur_id = #{purdPurId,jdbcType=INTEGER},
      purd_pdt_code = #{purdPdtCode,jdbcType=INTEGER},
      purd_qty = #{purdQty,jdbcType=DOUBLE},
      purd_price = #{purdPrice,jdbcType=DECIMAL},
      purd_tamount = #{purdTamount,jdbcType=DECIMAL},
      purd_discount = #{purdDiscount,jdbcType=DOUBLE},
      purd_bonus = #{purdBonus,jdbcType=DOUBLE},
      purd_status = #{purdStatus,jdbcType=VARCHAR},
      purd_previous_qty = #{purdPreviousQty,jdbcType=DOUBLE},
      purd_remarks = #{purdRemarks,jdbcType=VARCHAR},
      purd_mtrade_price = #{purdMtradePrice,jdbcType=DECIMAL},
      purd_expiry_dt = #{purdExpiryDt,jdbcType=DATE},
      purd_serialNo= #{purdSerialNo,jdbcType=VARCHAR}
    where purd_id = #{purdId,jdbcType=INTEGER}
  </update>
  <resultMap id="BaseResultMapWrapper" extends="BaseResultMap" type="com.topline.model.wrappers.PurchaseDetailWrapper" >    
    <result column="pdt_description" property="_purdPdtCode" jdbcType="VARCHAR" /> 
    <result column="pur_invono" property="purInvono" jdbcType="VARCHAR" /> 
    <result column="pur_date" property="purDate" jdbcType="DATE" /> 
    <result column="pur_acc_code" property="purAccCode" jdbcType="INTEGER" /> 
    <result column="acc_name" property="_purAccCode" jdbcType="VARCHAR" />    
  </resultMap>
   <select id="fetchPurchaseDetails" parameterType="java.util.HashMap" resultMap="BaseResultMapWrapper" >
	   SELECT purd_id, purd_pur_id, purd_pdt_code, purd_qty, purd_price, purd_tamount, purd_discount, 
		    purd_bonus, purd_status, purd_previous_qty, purd_remarks, purd_mtrade_price, purd_expiry_dt,purd_serialNo,pdt_description
		FROM inv_purchases_details, inv_products
		WHERE purd_pdt_code=pdt_code
        <if test="purId != null">
          AND  purd_pur_id =  #{purId,jdbcType=INTEGER}
      </if>	
   </select>
   <select id="fetchRptPurchases" parameterType="java.util.HashMap" resultMap="BaseResultMapWrapper" >
	   SELECT purd_id, purd_pur_id, purd_pdt_code, purd_qty, purd_price, purd_tamount, purd_discount, 
		    purd_bonus, purd_status, purd_previous_qty, purd_remarks, purd_mtrade_price, purd_expiry_dt,purd_serialNo,pdt_description,
        pur_invono,pur_date,pur_acc_code,acc_name
		FROM inv_purchases_details, inv_products,inv_purchases,inv_accounts
		WHERE purd_pdt_code=pdt_code
        AND pur_id=purd_pur_id
        AND acc_code=pur_acc_code
        <if test="purId != null">
          AND  purd_pur_id =  #{purId,jdbcType=INTEGER}
      </if>	
      <if test="accCode != null">
          AND  pur_acc_code =  #{accCode,jdbcType=INTEGER}
      </if>
      <if test="product != null">
          AND  pdt_code =  #{product,jdbcType=INTEGER}
      </if>
      <if test="purStatus != null">
          AND  pur_status =  #{purStatus,jdbcType=VARCHAR}
      </if>	
       <if test="dateFrom !=null"  >
      	AND  pur_date BETWEEN  #{dateFrom,jdbcType=DATE} AND #{dateTo,jdbcType=DATE}
      </if>
      <if test="limit !=null">
       LIMIT #{start,jdbcType=INTEGER},#{limit,jdbcType=INTEGER}
      </if>
      
   </select>
    <resultMap id="SummaryResultMap" type="com.topline.model.Summary" >
    	 <result column="myCount" property="myCount" jdbcType="DECIMAL" />
    	 <result column="mySum" property="mySummary" jdbcType="DECIMAL" />
    </resultMap>
   <select id="fetchRptPurchasesCount" parameterType="java.util.HashMap" resultMap="SummaryResultMap">
	   SELECT COUNT(purd_id) AS myCount,SUM(purd_qty*purd_price) AS mySum
		FROM inv_purchases_details, inv_products,inv_purchases,inv_accounts
		WHERE purd_pdt_code=pdt_code
        AND pur_id=purd_pur_id
        AND acc_code=pur_acc_code
        <if test="purId != null">
          AND  purd_pur_id =  #{purId,jdbcType=INTEGER}
      </if>	
      <if test="accCode != null">
          AND  pur_acc_code =  #{accCode,jdbcType=INTEGER}
      </if>
      <if test="product != null">
          AND  pdt_code =  #{product,jdbcType=INTEGER}
      </if>
      <if test="purStatus != null">
          AND  pur_status =  #{purStatus,jdbcType=VARCHAR}
      </if>	
       <if test="dateFrom !=null"  >
      	AND  pur_date BETWEEN  #{dateFrom,jdbcType=DATE} AND #{dateTo,jdbcType=DATE}
      </if>
      
   </select>
</mapper>